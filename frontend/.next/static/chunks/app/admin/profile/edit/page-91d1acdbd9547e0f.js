(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5360],{25498:function(e,t,a){"use strict";a.d(t,{Z:function(){return o}});var r=a(57068);let o=(0,r.Z)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},18365:function(e,t,a){"use strict";a.d(t,{Z:function(){return o}});var r=a(57068);let o=(0,r.Z)("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]])},33085:function(e,t,a){"use strict";a.d(t,{Z:function(){return o}});var r=a(57068);let o=(0,r.Z)("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]])},85154:function(e,t,a){Promise.resolve().then(a.bind(a,21867))},21867:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return AdminEditProfilePage}});var r=a(37821),o=a(58078),s=a(96871),n=a.n(s),i=a(45039),l=a.n(i),c=a(25498),u=a(33085),d=a(18365),h=a(86981),m=a(26709),g=a(8494);function AdminEditProfilePage(){let{updateUser:e}=(0,m.useAuth)(),[t,a]=(0,o.useState)({name:"",authorName:"",bio:"",location:"",website:""}),[s,i]=(0,o.useState)(""),[p,y]=(0,o.useState)(!0),[f,b]=(0,o.useState)(!1),[v,S]=(0,o.useState)(""),[x,w]=(0,o.useState)(null);(0,o.useEffect)(()=>{fetchAdminData()},[]);let fetchAdminData=async()=>{try{let e=await g.Sb.getAdminProfile(),t=e.data.user;a({name:t.name||"",authorName:t.username||t.authorName||"",bio:t.bio||"",location:t.location||"",website:t.website||""}),i(t.avatar||"")}catch(e){console.error("Error fetching admin data:",e),S("Failed to load admin data")}finally{y(!1)}},handleSubmit=async a=>{var r,o,n,l,c,u,d,h;a.preventDefault(),b(!0),S("");try{if(x){let a=new FormData;a.append("avatar",x),a.append("name",t.name),a.append("authorName",t.authorName),a.append("bio",t.bio),a.append("location",t.location),a.append("website",t.website);let c=await fetch("/api/v1/admin/profile",{method:"PATCH",headers:{Authorization:"Bearer ".concat(localStorage.getItem("dhyey_token"))},body:a});if(!c.ok)throw Error("Failed to update profile with photo");let u=await c.json();e({name:t.name,username:t.authorName,bio:t.bio,location:t.location,website:t.website,avatar:null===(o=u.data)||void 0===o?void 0:null===(r=o.user)||void 0===r?void 0:r.avatar}),i((null===(l=u.data)||void 0===l?void 0:null===(n=l.user)||void 0===n?void 0:n.avatar)||s),w(null)}else{let a=await g.Sb.updateAdminProfile(t);e({name:t.name,username:t.authorName,bio:t.bio,location:t.location,website:t.website,avatar:(null===(u=a.data)||void 0===u?void 0:null===(c=u.user)||void 0===c?void 0:c.avatar)||s})}S("Admin profile updated successfully!")}catch(e){S((null===(h=e.response)||void 0===h?void 0:null===(d=h.data)||void 0===d?void 0:d.message)||e.message||"Failed to update admin profile")}finally{b(!1)}};return p?(0,r.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,r.jsx)("p",{className:"text-gray-600",children:"Loading..."})}):(0,r.jsx)("div",{className:"min-h-screen bg-gray-50",children:(0,r.jsxs)("div",{className:"max-w-2xl mx-auto",children:[(0,r.jsx)("div",{className:"bg-white border-b border-gray-200 px-4 py-4",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,r.jsx)(n(),{href:"/admin/profile",className:"text-gray-600 hover:text-gray-900",children:(0,r.jsx)(c.Z,{size:20})}),(0,r.jsx)("h1",{className:"text-xl font-bold text-gray-900",children:"Edit Admin Profile"})]}),(0,r.jsxs)("button",{onClick:handleSubmit,disabled:f,className:"bg-purple-500 text-white px-4 py-2 rounded-lg font-medium hover:bg-purple-600 transition-colors flex items-center space-x-2 disabled:opacity-50 disabled:cursor-not-allowed",children:[(0,r.jsx)(u.Z,{size:16}),(0,r.jsx)("span",{children:f?"Saving...":"Save"})]})]})}),(0,r.jsxs)("div",{className:"bg-white mt-4 rounded-lg border border-gray-200",children:[(0,r.jsxs)("form",{onSubmit:handleSubmit,className:"p-6 space-y-6",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-6",children:[(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(l(),{src:(0,h.E$)(s),alt:"Admin Profile",width:100,height:100,className:"rounded-full"}),(0,r.jsx)("input",{type:"file",id:"profilePhoto",accept:"image/*",className:"hidden",onChange:e=>{var t;let a=null===(t=e.target.files)||void 0===t?void 0:t[0];if(a){w(a);let e=URL.createObjectURL(a);i(e)}}}),(0,r.jsx)("button",{type:"button",onClick:()=>{var e;return null===(e=document.getElementById("profilePhoto"))||void 0===e?void 0:e.click()},className:"absolute bottom-0 right-0 bg-purple-500 text-white p-2 rounded-full hover:bg-purple-600 transition-colors",children:(0,r.jsx)(d.Z,{size:16})})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"font-medium text-gray-900",children:"Admin Profile Photo"}),(0,r.jsx)("p",{className:"text-sm text-gray-600",children:"Click the camera icon to update your photo"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Full Name"}),(0,r.jsx)("input",{type:"text",value:t.name,onChange:e=>a({...t,name:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent text-gray-900 bg-white"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Author Name"}),(0,r.jsx)("input",{type:"text",value:t.authorName,onChange:e=>a({...t,authorName:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent text-gray-900 bg-white"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Bio"}),(0,r.jsx)("textarea",{value:t.bio,onChange:e=>a({...t,bio:e.target.value}),rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent resize-none text-gray-900 bg-white",placeholder:"Tell us about yourself..."})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Location"}),(0,r.jsx)("input",{type:"text",value:t.location,onChange:e=>a({...t,location:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent text-gray-900 bg-white",placeholder:"City, Country"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Website"}),(0,r.jsx)("input",{type:"text",value:t.website,onChange:e=>a({...t,website:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent text-gray-900 bg-white",placeholder:"yourwebsite.com"})]})]}),v&&(0,r.jsx)("div",{className:"mt-4 p-3 rounded-lg text-center ".concat(v.includes("successfully")?"bg-green-100 text-green-700 border border-green-200":"bg-red-100 text-red-700 border border-red-200"),children:v})]})]})})}},26709:function(e,t,a){"use strict";a.r(t),a.d(t,{AuthProvider:function(){return AuthProvider},useAuth:function(){return useAuth},withAuth:function(){return withAuth}});var r=a(37821),o=a(58078),s=a(8494);let n=(0,o.createContext)(void 0);function AuthProvider(e){let{children:t}=e,[a,i]=(0,o.useState)(null),[l,c]=(0,o.useState)(!0);(0,o.useEffect)(()=>{checkAuthStatus()},[]);let checkAuthStatus=async()=>{try{let e=localStorage.getItem("dhyey_user"),t=localStorage.getItem("dhyey_token"),a=localStorage.getItem("dhyey_token_expiry");if(e&&t){if(a&&new Date().getTime()>parseInt(a)){console.log("Token expired, logging out"),logout();return}i(JSON.parse(e)),validateTokenInBackground(t)}}catch(e){console.error("Auth check failed:",e),logout()}finally{c(!1)}},validateTokenInBackground=async e=>{try{let t=await fetch("".concat("https://api.dhyey.delpat.in/api/v1","/users/me"),{headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"},credentials:"include"});t.ok||(console.log("Token validation failed, logging out"),logout())}catch(e){console.error("Background token validation failed:",e)}},checkTokenValidity=async()=>{try{let e=localStorage.getItem("dhyey_token");if(!e)return!1;let t=await fetch("".concat("https://api.dhyey.delpat.in/api/v1","/users/me"),{headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"},credentials:"include"});return t.ok}catch(e){return console.error("Token validation failed:",e),!1}},login=async function(e,t){let a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];c(!0);try{let r=await s.kv.login(e,t),o={id:r.data.user._id,name:r.data.user.name,username:r.data.user.username,email:r.data.user.email,avatar:r.data.user.avatar,role:r.data.user.role||"user"},n=a?new Date().getTime()+2592e6:new Date().getTime()+864e5;localStorage.setItem("dhyey_user",JSON.stringify(o)),localStorage.setItem("dhyey_token",r.token),localStorage.setItem("dhyey_token_expiry",n.toString()),localStorage.setItem("dhyey_remember_me",a.toString()),i(o)}catch(e){if(e.message&&e.message.includes("suspended"))throw Error("Your account has been suspended. Please contact administration for further details.");throw e}finally{c(!1)}},register=async e=>{c(!0);try{let t=await s.kv.register(e),a={id:t.data.user._id,name:t.data.user.name,username:t.data.user.username,email:t.data.user.email,avatar:t.data.user.avatar,role:t.data.user.role||"user"};localStorage.setItem("dhyey_user",JSON.stringify(a)),localStorage.setItem("dhyey_token",t.token),i(a)}finally{c(!1)}},logout=async()=>{try{await s.kv.logout()}catch(e){console.error("Backend logout failed:",e)}localStorage.removeItem("dhyey_user"),localStorage.removeItem("dhyey_token"),localStorage.removeItem("dhyey_token_expiry"),localStorage.removeItem("dhyey_remember_me"),i(null),window.location.href="/auth/login"};return(0,r.jsx)(n.Provider,{value:{user:a,isLoading:l,isAuthenticated:!!a,login,register,logout,updateUser:e=>{if(a){let t={...a,...e};i(t),localStorage.setItem("dhyey_user",JSON.stringify(t))}},checkTokenValidity},children:t})}function useAuth(){let e=(0,o.useContext)(n);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}function withAuth(e){return function(t){let{isAuthenticated:a,isLoading:o}=useAuth();return o?(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600"})}):a?(0,r.jsx)(e,{...t}):(window.location.href="/auth/login",null)}}},8494:function(e,t,a){"use strict";a.d(t,{OF:function(){return i},Sb:function(){return l},TV:function(){return s},fh:function(){return n},kv:function(){return o}});let r="https://api.dhyey.delpat.in/api/v1",apiRequest=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=localStorage.getItem("dhyey_token"),o=localStorage.getItem("dhyey_token_expiry");if(a&&o&&new Date().getTime()>parseInt(o))throw console.log("Token expired, clearing session"),localStorage.removeItem("dhyey_user"),localStorage.removeItem("dhyey_token"),localStorage.removeItem("dhyey_token_expiry"),localStorage.removeItem("dhyey_remember_me"),window.location.pathname.includes("/auth/")||(window.location.href="/auth/login"),Error("Session expired. Please log in again.");let s={...t,headers:{"Content-Type":"application/json",...a&&{Authorization:"Bearer ".concat(a)},...t.headers},...a&&{credentials:"include"}},n=await fetch("".concat(r).concat(e),s);if(401===n.status){if(e.includes("/auth/update-password")||e.includes("/auth/change-password")){let e=await n.json().catch(()=>({}));throw Error(e.message||"Current password is incorrect")}throw console.log("Unauthorized request, clearing session"),localStorage.removeItem("dhyey_user"),localStorage.removeItem("dhyey_token"),localStorage.removeItem("dhyey_token_expiry"),localStorage.removeItem("dhyey_remember_me"),window.location.pathname.includes("/auth/")||(window.location.href="/auth/login"),Error("Session expired. Please log in again.")}if(!n.ok){let e=await n.json().catch(()=>({}));throw Error(e.message||"HTTP error! status: ".concat(n.status))}return n.json()},o={login:(e,t)=>fetch("".concat(r,"/auth/login"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})}).then(async e=>{if(!e.ok){let t=await e.json().catch(()=>({}));throw Error(t.message||"HTTP error! status: ".concat(e.status))}return e.json()}),register:e=>fetch("".concat(r,"/auth/signup"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then(async e=>{let t=await e.json();if(!e.ok)throw Error(t.message||"HTTP error! status: ".concat(e.status));return t}),forgotPassword:e=>apiRequest("/auth/forgot-password",{method:"POST",body:JSON.stringify({email:e})}),resetPassword:(e,t,a)=>apiRequest("/auth/reset-password/".concat(e),{method:"PATCH",body:JSON.stringify({password:t,passwordConfirm:a})}),updatePassword:(e,t,a)=>apiRequest("/auth/update-password",{method:"PATCH",body:JSON.stringify({passwordCurrent:e,password:t,passwordConfirm:a})}),changePassword:(e,t,a)=>apiRequest("/auth/change-password",{method:"PATCH",body:JSON.stringify({passwordCurrent:e,password:t,passwordConfirm:a})}),logout:()=>apiRequest("/auth/logout",{method:"POST"}),refreshToken:()=>apiRequest("/auth/refresh-token",{method:"POST"})},s={getMe:()=>apiRequest("/users/me"),updateMe:e=>apiRequest("/users/me",{method:"PATCH",body:JSON.stringify(e)}),getUserProfile:e=>apiRequest("/users/profile/".concat(e)),followUser:e=>apiRequest("/users/".concat(e,"/follow"),{method:"POST"}),getUserFollowers:e=>apiRequest("/users/".concat(e,"/followers")),getUserFollowing:e=>apiRequest("/users/".concat(e,"/following")),getUserSavedStories:e=>apiRequest("/users/".concat(e,"/saved")),getUserLikedStories:()=>apiRequest("/users/me/liked"),getAllUsers:()=>apiRequest("/users/admin/all")},n={getPublicStories:e=>apiRequest("/stories".concat(e?"?".concat(e):"")),getStoryById:e=>apiRequest("/stories/".concat(e)),createStory:e=>apiRequest("/stories",{method:"POST",body:JSON.stringify(e)}),updateStory:(e,t)=>apiRequest("/stories/".concat(e),{method:"PATCH",body:JSON.stringify(t)}),deleteStory:e=>apiRequest("/stories/".concat(e),{method:"DELETE"}),likeStory:e=>apiRequest("/stories/".concat(e,"/like"),{method:"POST"}),saveStory:e=>apiRequest("/stories/".concat(e,"/save"),{method:"POST"}),shareStory:(e,t)=>apiRequest("/stories/".concat(e,"/share"),{method:"POST",body:JSON.stringify(t||{})}),getUserStories:e=>apiRequest("/stories/user/".concat(e)),searchStories:(e,t)=>{let a=new URLSearchParams({q:e,...t});return apiRequest("/stories/search?".concat(a))},getStoryComments:e=>apiRequest("/stories/".concat(e,"/comments")),addComment:(e,t,a)=>apiRequest("/stories/".concat(e,"/comments"),{method:"POST",body:JSON.stringify({content:t,parentComment:a})}),likeComment:(e,t)=>apiRequest("/stories/".concat(e,"/comments/").concat(t,"/like"),{method:"POST"})},i={searchStories:(e,t)=>{let a=t?Object.fromEntries(Object.entries(t).filter(e=>{let[t,a]=e;return null!=a&&""!==a})):{},r=new URLSearchParams({q:e,...a});return console.log("API call URL:","/search/stories?".concat(r)),apiRequest("/search/stories?".concat(r))},searchUsers:e=>{let t=new URLSearchParams({q:e});return apiRequest("/search/users?".concat(t))},getSearchSuggestions:e=>{let t=new URLSearchParams({q:e});return apiRequest("/search/suggestions?".concat(t))},getSearchFilters:()=>apiRequest("/search/filters"),globalSearch:e=>{let t=new URLSearchParams({q:e});return apiRequest("/search/global?".concat(t))}},l={getAllStories:e=>apiRequest("/admin/stories".concat(e?"?".concat(e):"")),getStoryForReview:e=>apiRequest("/admin/stories/".concat(e)),approveStory:e=>apiRequest("/admin/stories/".concat(e,"/approve"),{method:"PATCH"}),rejectStory:(e,t)=>apiRequest("/admin/stories/".concat(e,"/reject"),{method:"PATCH",body:JSON.stringify({reason:t})}),bulkApproveStories:e=>apiRequest("/admin/stories/bulk-approve",{method:"PATCH",body:JSON.stringify({storyIds:e})}),bulkRejectStories:(e,t)=>apiRequest("/admin/stories/bulk-reject",{method:"PATCH",body:JSON.stringify({storyIds:e,reason:t})}),getAllUsers:e=>apiRequest("/users/admin/all".concat(e?"?".concat(e):"")),suspendUser:(e,t,a)=>apiRequest("/admin/users/".concat(e,"/suspend"),{method:"PATCH",body:JSON.stringify({reason:t,duration:a})}),unsuspendUser:e=>apiRequest("/admin/users/".concat(e,"/unsuspend"),{method:"PATCH"}),deleteUser:e=>apiRequest("/users/".concat(e),{method:"DELETE"}),getAllAdmins:()=>apiRequest("/admin/admins"),getAdminProfile:()=>apiRequest("/admin/profile"),updateAdminProfile:e=>apiRequest("/admin/profile",{method:"PATCH",body:JSON.stringify(e)}),getAdminSettings:()=>apiRequest("/admin/settings"),updateAdminSettings:e=>apiRequest("/admin/settings",{method:"PATCH",body:JSON.stringify(e)}),getAnalytics:()=>apiRequest("/admin/analytics"),getDashboardStats:()=>apiRequest("/admin/dashboard-stats")}},86981:function(e,t,a){"use strict";a.d(t,{E$:function(){return getAvatarUrl},Jn:function(){return getImageUrl}});let getImageUrl=(e,t)=>{if(!e)return t||"https://ui-avatars.com/api/?name=User&background=6366f1&color=fff&size=150";if(e.startsWith("http://")||e.startsWith("https://")||e.startsWith("blob:"))return e;let a=e.startsWith("/")?e:"/".concat(e);return"".concat("https://api.dhyey.delpat.in/api/v1").concat(a)},getAvatarUrl=e=>getImageUrl(e,"https://ui-avatars.com/api/?name=User&background=6366f1&color=fff&size=150")},96871:function(e,t,a){e.exports=a(92054)}},function(e){e.O(0,[2054,6895,7115,2835,1744],function(){return e(e.s=85154)}),_N_E=e.O()}]);