"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2283],{26709:function(e,t,o){o.r(t),o.d(t,{AuthProvider:function(){return AuthProvider},useAuth:function(){return useAuth},withAuth:function(){return withAuth}});var r=o(37821),a=o(58078),s=o(8494);let n=(0,a.createContext)(void 0);function AuthProvider(e){let{children:t}=e,[o,i]=(0,a.useState)(null),[c,l]=(0,a.useState)(!0);(0,a.useEffect)(()=>{checkAuthStatus()},[]);let checkAuthStatus=async()=>{try{let e=localStorage.getItem("dhyey_user"),t=localStorage.getItem("dhyey_token"),o=localStorage.getItem("dhyey_token_expiry");if(e&&t){if(o&&new Date().getTime()>parseInt(o)){console.log("Token expired, logging out"),logout();return}i(JSON.parse(e)),validateTokenInBackground(t)}}catch(e){console.error("Auth check failed:",e),logout()}finally{l(!1)}},validateTokenInBackground=async e=>{try{let t=await fetch("".concat("https://api.dhyey.delpat.in/api/v1","/users/me"),{headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"},credentials:"include"});t.ok||(console.log("Token validation failed, logging out"),logout())}catch(e){console.error("Background token validation failed:",e)}},checkTokenValidity=async()=>{try{let e=localStorage.getItem("dhyey_token");if(!e)return!1;let t=await fetch("".concat("https://api.dhyey.delpat.in/api/v1","/users/me"),{headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"},credentials:"include"});return t.ok}catch(e){return console.error("Token validation failed:",e),!1}},login=async function(e,t){let o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];l(!0);try{let r=await s.kv.login(e,t),a={id:r.data.user._id,name:r.data.user.name,username:r.data.user.username,email:r.data.user.email,avatar:r.data.user.avatar,role:r.data.user.role||"user"},n=o?new Date().getTime()+2592e6:new Date().getTime()+864e5;localStorage.setItem("dhyey_user",JSON.stringify(a)),localStorage.setItem("dhyey_token",r.token),localStorage.setItem("dhyey_token_expiry",n.toString()),localStorage.setItem("dhyey_remember_me",o.toString()),i(a)}catch(e){if(e.message&&e.message.includes("suspended"))throw Error("Your account has been suspended. Please contact administration for further details.");throw e}finally{l(!1)}},register=async e=>{l(!0);try{let t=await s.kv.register(e),o={id:t.data.user._id,name:t.data.user.name,username:t.data.user.username,email:t.data.user.email,avatar:t.data.user.avatar,role:t.data.user.role||"user"};localStorage.setItem("dhyey_user",JSON.stringify(o)),localStorage.setItem("dhyey_token",t.token),i(o)}finally{l(!1)}},logout=async()=>{try{await s.kv.logout()}catch(e){console.error("Backend logout failed:",e)}localStorage.removeItem("dhyey_user"),localStorage.removeItem("dhyey_token"),localStorage.removeItem("dhyey_token_expiry"),localStorage.removeItem("dhyey_remember_me"),i(null),window.location.href="/auth/login"};return(0,r.jsx)(n.Provider,{value:{user:o,isLoading:c,isAuthenticated:!!o,login,register,logout,updateUser:e=>{if(o){let t={...o,...e};i(t),localStorage.setItem("dhyey_user",JSON.stringify(t))}},checkTokenValidity},children:t})}function useAuth(){let e=(0,a.useContext)(n);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}function withAuth(e){return function(t){let{isAuthenticated:o,isLoading:a}=useAuth();return a?(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600"})}):o?(0,r.jsx)(e,{...t}):(window.location.href="/auth/login",null)}}},8494:function(e,t,o){o.d(t,{OF:function(){return i},Sb:function(){return c},TV:function(){return s},fh:function(){return n},kv:function(){return a}});let r="https://api.dhyey.delpat.in/api/v1",apiRequest=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=localStorage.getItem("dhyey_token"),a=localStorage.getItem("dhyey_token_expiry");if(o&&a&&new Date().getTime()>parseInt(a))throw console.log("Token expired, clearing session"),localStorage.removeItem("dhyey_user"),localStorage.removeItem("dhyey_token"),localStorage.removeItem("dhyey_token_expiry"),localStorage.removeItem("dhyey_remember_me"),window.location.pathname.includes("/auth/")||(window.location.href="/auth/login"),Error("Session expired. Please log in again.");let s={...t,headers:{"Content-Type":"application/json",...o&&{Authorization:"Bearer ".concat(o)},...t.headers},...o&&{credentials:"include"}},n=await fetch("".concat(r).concat(e),s);if(401===n.status){if(e.includes("/auth/update-password")||e.includes("/auth/change-password")){let e=await n.json().catch(()=>({}));throw Error(e.message||"Current password is incorrect")}throw console.log("Unauthorized request, clearing session"),localStorage.removeItem("dhyey_user"),localStorage.removeItem("dhyey_token"),localStorage.removeItem("dhyey_token_expiry"),localStorage.removeItem("dhyey_remember_me"),window.location.pathname.includes("/auth/")||(window.location.href="/auth/login"),Error("Session expired. Please log in again.")}if(!n.ok){let e=await n.json().catch(()=>({}));throw Error(e.message||"HTTP error! status: ".concat(n.status))}return n.json()},a={login:(e,t)=>fetch("".concat(r,"/auth/login"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})}).then(async e=>{if(!e.ok){let t=await e.json().catch(()=>({}));throw Error(t.message||"HTTP error! status: ".concat(e.status))}return e.json()}),register:e=>fetch("".concat(r,"/auth/signup"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then(async e=>{let t=await e.json();if(!e.ok)throw Error(t.message||"HTTP error! status: ".concat(e.status));return t}),forgotPassword:e=>apiRequest("/auth/forgot-password",{method:"POST",body:JSON.stringify({email:e})}),resetPassword:(e,t,o)=>apiRequest("/auth/reset-password/".concat(e),{method:"PATCH",body:JSON.stringify({password:t,passwordConfirm:o})}),updatePassword:(e,t,o)=>apiRequest("/auth/update-password",{method:"PATCH",body:JSON.stringify({passwordCurrent:e,password:t,passwordConfirm:o})}),changePassword:(e,t,o)=>apiRequest("/auth/change-password",{method:"PATCH",body:JSON.stringify({passwordCurrent:e,password:t,passwordConfirm:o})}),logout:()=>apiRequest("/auth/logout",{method:"POST"}),refreshToken:()=>apiRequest("/auth/refresh-token",{method:"POST"})},s={getMe:()=>apiRequest("/users/me"),updateMe:e=>apiRequest("/users/me",{method:"PATCH",body:JSON.stringify(e)}),getUserProfile:e=>apiRequest("/users/profile/".concat(e)),followUser:e=>apiRequest("/users/".concat(e,"/follow"),{method:"POST"}),getUserFollowers:e=>apiRequest("/users/".concat(e,"/followers")),getUserFollowing:e=>apiRequest("/users/".concat(e,"/following")),getUserSavedStories:e=>apiRequest("/users/".concat(e,"/saved")),getUserLikedStories:()=>apiRequest("/users/me/liked"),getAllUsers:()=>apiRequest("/users/admin/all")},n={getPublicStories:e=>apiRequest("/stories".concat(e?"?".concat(e):"")),getStoryById:e=>apiRequest("/stories/".concat(e)),createStory:e=>apiRequest("/stories",{method:"POST",body:JSON.stringify(e)}),updateStory:(e,t)=>apiRequest("/stories/".concat(e),{method:"PATCH",body:JSON.stringify(t)}),deleteStory:e=>apiRequest("/stories/".concat(e),{method:"DELETE"}),likeStory:e=>apiRequest("/stories/".concat(e,"/like"),{method:"POST"}),saveStory:e=>apiRequest("/stories/".concat(e,"/save"),{method:"POST"}),shareStory:(e,t)=>apiRequest("/stories/".concat(e,"/share"),{method:"POST",body:JSON.stringify(t||{})}),getUserStories:e=>apiRequest("/stories/user/".concat(e)),searchStories:(e,t)=>{let o=new URLSearchParams({q:e,...t});return apiRequest("/stories/search?".concat(o))},getStoryComments:e=>apiRequest("/stories/".concat(e,"/comments")),addComment:(e,t,o)=>apiRequest("/stories/".concat(e,"/comments"),{method:"POST",body:JSON.stringify({content:t,parentComment:o})}),likeComment:(e,t)=>apiRequest("/stories/".concat(e,"/comments/").concat(t,"/like"),{method:"POST"})},i={searchStories:(e,t)=>{let o=t?Object.fromEntries(Object.entries(t).filter(e=>{let[t,o]=e;return null!=o&&""!==o})):{},r=new URLSearchParams({q:e,...o});return console.log("API call URL:","/search/stories?".concat(r)),apiRequest("/search/stories?".concat(r))},searchUsers:e=>{let t=new URLSearchParams({q:e});return apiRequest("/search/users?".concat(t))},getSearchSuggestions:e=>{let t=new URLSearchParams({q:e});return apiRequest("/search/suggestions?".concat(t))},getSearchFilters:()=>apiRequest("/search/filters"),globalSearch:e=>{let t=new URLSearchParams({q:e});return apiRequest("/search/global?".concat(t))}},c={getAllStories:e=>apiRequest("/admin/stories".concat(e?"?".concat(e):"")),getStoryForReview:e=>apiRequest("/admin/stories/".concat(e)),approveStory:e=>apiRequest("/admin/stories/".concat(e,"/approve"),{method:"PATCH"}),rejectStory:(e,t)=>apiRequest("/admin/stories/".concat(e,"/reject"),{method:"PATCH",body:JSON.stringify({reason:t})}),bulkApproveStories:e=>apiRequest("/admin/stories/bulk-approve",{method:"PATCH",body:JSON.stringify({storyIds:e})}),bulkRejectStories:(e,t)=>apiRequest("/admin/stories/bulk-reject",{method:"PATCH",body:JSON.stringify({storyIds:e,reason:t})}),getAllUsers:e=>apiRequest("/users/admin/all".concat(e?"?".concat(e):"")),suspendUser:(e,t,o)=>apiRequest("/admin/users/".concat(e,"/suspend"),{method:"PATCH",body:JSON.stringify({reason:t,duration:o})}),unsuspendUser:e=>apiRequest("/admin/users/".concat(e,"/unsuspend"),{method:"PATCH"}),deleteUser:e=>apiRequest("/users/".concat(e),{method:"DELETE"}),getAllAdmins:()=>apiRequest("/admin/admins"),getAdminProfile:()=>apiRequest("/admin/profile"),updateAdminProfile:e=>apiRequest("/admin/profile",{method:"PATCH",body:JSON.stringify(e)}),getAdminSettings:()=>apiRequest("/admin/settings"),updateAdminSettings:e=>apiRequest("/admin/settings",{method:"PATCH",body:JSON.stringify(e)}),getAnalytics:()=>apiRequest("/admin/analytics"),getDashboardStats:()=>apiRequest("/admin/dashboard-stats")}},88742:function(e,t,o){o.d(t,{Mv:function(){return shareProfile},c0:function(){return showNotification}});let showNotification=e=>{let{type:t,title:o,message:r,duration:a=3e3}=e,s=document.createElement("div");s.className="fixed top-4 right-4 z-50 p-4 rounded-lg shadow-lg max-w-sm transition-all duration-300 ".concat("success"===t?"bg-green-100 text-green-800 border border-green-200":"error"===t?"bg-red-100 text-red-800 border border-red-200":"warning"===t?"bg-yellow-100 text-yellow-800 border border-yellow-200":"bg-blue-100 text-blue-800 border border-blue-200"),s.innerHTML='\n    <div class="flex items-start">\n      <div class="flex-1">\n        <div class="font-medium">'.concat(o,"</div>\n        ").concat(r?'<div class="text-sm mt-1">'.concat(r,"</div>"):"",'\n      </div>\n      <button class="ml-2 text-gray-400 hover:text-gray-600" onclick="this.parentElement.parentElement.remove()">\n        \xd7\n      </button>\n    </div>\n  '),document.body.appendChild(s),setTimeout(()=>{s.parentElement&&s.remove()},a)},handleAsyncError=function(e){var t,o;let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"An unexpected error occurred";console.error("Error:",e);let a=(null==e?void 0:null===(o=e.response)||void 0===o?void 0:null===(t=o.data)||void 0===t?void 0:t.message)||(null==e?void 0:e.message)||r;showNotification({type:"error",title:"Error",message:a})},showSuccess=(e,t)=>{showNotification({type:"success",title:e,message:t})},shareProfile=async(e,t)=>{let o="".concat(window.location.origin,"/profile/").concat(t.username),r="Check out ".concat(t.name,"'s profile on Dhyey");try{switch(e){case"copy":await navigator.clipboard.writeText(o),showSuccess("Link Copied","Profile link copied to clipboard!");break;case"twitter":window.open("https://twitter.com/intent/tweet?text=".concat(encodeURIComponent(r),"&url=").concat(encodeURIComponent(o)),"_blank");break;case"facebook":window.open("https://www.facebook.com/sharer/sharer.php?u=".concat(encodeURIComponent(o)),"_blank");break;case"linkedin":window.open("https://www.linkedin.com/sharing/share-offsite/?url=".concat(encodeURIComponent(o)),"_blank");break;default:throw Error("Unsupported platform")}}catch(e){handleAsyncError(e,"Failed to share profile")}}}}]);